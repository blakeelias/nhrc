<!DOCTYPE html>
<html>
  <head>
    <title>New Haven Report Card</title>
    <link href='css/bootstrap.min.css' rel='stylesheet'>
    <link href='css/main.css' rel='stylesheet'>
    <link href='css/stylesheet.css' rel='stylesheet'>

    <script src="Chart.min.js"></script>
  </head>

  <!-- body -->
  <body>
    <div class='navbar navbar-default navbar-static-top'>
      <div class='container'>
        <a href='/nhrc' class='navbar-brand'>New Haven Report Card</a>

        <ul class='nav navbar-nav navbar-right'>
          <li><a href='http://seeclickfix.com' target='new'>Dashboard</a></li>
          <li><a href='http://seeclickfix.com' target='new'>Pothole Evolution</a></li>
          <li><a href='http://seeclickfix.com' target='new'>See Click Fix</a></li>
          <li><a href='chart.html'>Chart</a></li>
        </ul>
      </div>
    </div>
<!-- end of navbar -->

<!-- beginning of main content -->

<!--
<div class="col-md-6">
  <div class="project-certification"></div>
    <div class="simple-bars-wrapper">
      <div class="vertical-separator"></div>      
    </div>
</div>
-->

<div class="col-md-12">
 <canvas id="myChart" style="width: 100%; height: 100%"></canvas>
</div>
            </div>
<!-- footer section -->

<div class="container">
  <div class="row spacer-bottom"></div>
</div>


<!-- footer -->
<div class='footer navbar navbar-fixed-bottom'>
  <div class='container'>
    <div class='row'>
      
    </div>
  </div>
</div>


    <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js'></script>
    <script src='js/bootstrap.min.js'></script>
    <script src='js/moment.min.js'></script>
    <script src='js/d3.min.js'></script>
    <script src='js/d3.legend.js'></script>
    <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
    <script src='js/jquery.csv-0.71.min.js'></script>
<!--    <script src='js/environ.js'></script> -->

    <script>
        // Get the context of the canvas element we want to select
        var ctx = document.getElementById("myChart").getContext("2d");

        var data = {
            labels: ["January", "February", "March", "April", "May", "June", "July"],
            datasets: [
                {
                    label: "Reported",
                    fillColor: "rgba(220,220,220,0.2)",
                    strokeColor: "rgba(220,220,220,1)",
                    pointColor: "rgba(220,220,220,1)",
                    pointStrokeColor: "#fff",
                    pointHighlightFill: "#fff",
                    pointHighlightStroke: "rgba(220,220,220,1)",
                    data: [65, 59, 80, 81, 56, 55, 40]
                },
                {
                    label: "Resolved",
                    fillColor: "rgba(151,187,205,0.2)",
                    strokeColor: "rgba(151,187,205,1)",
                    pointColor: "rgba(151,187,205,1)",
                    pointStrokeColor: "#fff",
                    pointHighlightFill: "#fff",
                    pointHighlightStroke: "rgba(151,187,205,1)",
                    data: [28, 48, 40, 19, 86, 27, 90]
                }
            ]
        };

        var myNewChart = new Chart(ctx).Line(data);

        function numDateIsIn(data, startDate, endDate, colNum) {
            var n = 0;
            for (i in data) {
                var row = data[i];
                var date = moment(row[colNum]);
                console.log("startDate: " + startDate);
                console.log("curret date: " + date._d);
                console.log("endDate: " + endDate);

                if (date <= endDate && date >= startDate) {
                    n += 1;
                    console.log('in range!!!!!!!!!!!!!!!');
                }
                console.log('---');
            }
            return n;
        }

        function splitByInterval(data, startDate, endDate, intervalNum, intervalStr, colNum) {
            console.log('splitByInterval: ' + startDate + ' ; endDate: ' + endDate);
            var nextStartMoment = moment(startDate);
            var endMoment = moment(endDate);
            var numInInterval = [];
            while (nextStartMoment < endMoment) {
                var intervalStartDate = nextStartMoment._d;
                var intervalEndDate = moment(intervalStartDate).add(intervalNum, intervalStr)._d;
                numInInterval.push(numDateIsIn(data, intervalStartDate, intervalEndDate, colNum));
                console.log('iteration');
                nextStartMoment = moment(intervalEndDate);
            }
            return numInInterval;
        }

        $(document).ready(function() {
            $.ajax({
                type: "GET",
                url: "scf_data.csv",
                dataType: "text",
                success: function(data) {
                    parsedData = $.csv.toArrays(data);
                    console.log(parsedData);
                    console.log(splitByInterval(parsedData, '2015-03-28T13:51:17-04:00', '2015-03-28T14:49:25-04:00', 5, 'minutes', 7));
                }
             });
        });
        
    </script>
  </body>
</html>