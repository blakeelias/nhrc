SELECT category,
COUNT(*) TOTAL,
SUM(CASE WHEN closed_at_local is not null THEN 1 ELSE 0 END) CLOSED,
CAST(SUM(CASE WHEN closed_at_local is not null THEN 1 ELSE 0 END) AS DECIMAL) / COUNT(*) PERCENT_CLOSED
FROM test
GROUP BY CATEGORY
ORDER BY PERCENT_CLOSED
